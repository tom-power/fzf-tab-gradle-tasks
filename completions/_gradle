_gradle 2>/dev/null
functions[_gradle_tasks_all]=${functions[_gradle]}

_gradle_tasks() {
  local -a tasks tasksDescriptions

  tasks=(
    "build"
    "clean"
    "test"
  )
  tasksDescriptions=(
    "build            -- Assembles and tests this project."
    "clean            -- Deletes the build directory."
    "test             -- Runs the unit tests."
  )

  local -a usedTasks
  usedTasks=("${words[@]:1}")

  local -a availableTasks availableTasksDescriptions  

  for index in {1..${#tasks[@]}}; do
    task="${tasks[index]}"
    if [[ ! " ${usedTasks[*]} " =~ " ${task} " ]]; then
       availableTasks+=("$task")
       availableTasksDescriptions+=("${tasksDescriptions[index]}")
    fi
  done

  compadd -d availableTasksDescriptions -a availableTasks
}

# https://github.com/Aloxaf/fzf-tab/issues/65#issuecomment-602144985
_gradle() {
  if [[ -v gradleTasksAll ]]; then
    _gradle_tasks_all
  else
    _gradle_tasks
  fi
}
